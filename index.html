<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRP - Quantitative Risk Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'JetBrains+Mono', monospace; background: #040508; color: #a0aec0; }
        .panel { background: #0d1117; border: 1px solid #30363d; border-radius: 12px; }
        .status-ok { color: #238636; text-shadow: 0 0 10px rgba(35, 134, 54, 0.5); }
        .status-warn { color: #d29922; }
        .status-stop { color: #f85149; }
    </style>
</head>
<body class="p-4 flex flex-col items-center">

    <div class="w-full max-w-md">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-lg font-bold text-white tracking-tighter">PROTOCOL<span class="text-blue-500">QRP v400</span></h1>
            <div class="text-[9px] bg-zinc-800 px-2 py-0.5 rounded border border-white/10 uppercase">Verified Logic</div>
        </div>

        <!-- Monitor de Telemetría -->
        <div class="panel p-6 mb-4 text-center">
            <p class="text-[10px] uppercase tracking-widest text-gray-500 mb-2">Última captura de nodo</p>
            <div id="val" class="text-7xl font-bold text-white mb-6">--</div>
            
            <div class="flex justify-between border-t border-zinc-800 pt-4 mb-4">
                <div class="text-left">
                    <p class="text-[8px] uppercase">Estabilidad Validada</p>
                    <p id="prob" class="text-xl font-bold text-blue-500">0%</p>
                </div>
                <div class="text-right">
                    <p class="text-[8px] uppercase">Riesgo Dinámico</p>
                    <p id="riesgo" class="text-xl font-bold">ALTO</p>
                </div>
            </div>

            <div id="box" class="bg-zinc-900 rounded-lg p-4 border border-zinc-800">
                <p id="sug" class="text-sm font-bold uppercase tracking-tighter">Iniciando Monitoreo</p>
            </div>
        </div>

        <!-- Target de Salida -->
        <div class="panel p-6 text-center">
            <p class="text-[10px] text-gray-500 uppercase mb-2">Meta de Salida Segura</p>
            <div id="tp_s" class="text-5xl font-bold text-white mb-2">--</div>
            <p id="fase" class="text-[9px] uppercase tracking-widest text-gray-400">Analizando Varianza...</p>
        </div>

        <p class="text-[8px] mt-8 text-center text-zinc-600 uppercase">
            Sistema de apoyo a la decisión basado en convergencia histórica. 
            No constituye garantía de resultados futuros.
        </p>
    </div>

    <script>
        const API = "https://cordlike-dylan-unstrenuously.ngrok-free.dev/data";

        async function update() {
            try {
                const r = await fetch(API, { headers: { "ngrok-skip-browser-warning": "69420" } });
                const d = await r.json();

                document.getElementById('val').innerText = d.ultimo_valor + 'x';
                document.getElementById('prob').innerText = d.estabilidad_estadistica;
                document.getElementById('riesgo').innerText = d.riesgo_ponderado;
                document.getElementById('sug').innerText = d.sugerencia;
                document.getElementById('tp_s').innerText = d.tp_s;
                document.getElementById('fase').innerText = d.fase;

                const sug = document.getElementById('sug');
                const riesgo = document.getElementById('riesgo');

                if(d.sugerencia.includes("ESTABLE")) {
                    sug.className = "text-sm font-bold uppercase status-ok";
                    riesgo.className = "text-xl font-bold status-ok";
                } else if(d.sugerencia.includes("ABSTENCIÓN")) {
                    sug.className = "text-sm font-bold uppercase status-stop";
                    riesgo.className = "text-xl font-bold status-stop";
                } else {
                    sug.className = "text-sm font-bold uppercase status-warn";
                    riesgo.className = "text-xl font-bold status-warn";
                }
            } catch(e) {}
        }
        setInterval(update, 800);
    </script>
</body>
</html>

